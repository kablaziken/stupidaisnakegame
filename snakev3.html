<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8">
  <title>Čūska ar līmeņiem</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <style>
    body { margin: 0; background: #111; display: flex; justify-content: center; align-items: center; height: 100vh; }
    canvas { border: 2px solid #fff; }
  </style>
</head>
<body>
<script>
  const gridSize = 20;
  const cols = 30;
  const rows = 30;

  let snake, food, dir;
  let gameOver = false;
  let score = 0;

  // Čūskas ātruma vadība
  let lastStepTime = 0;
  let stepInterval = 200; // ms starp soļiem (mainās pēc grūtības)

  let choosingDifficulty = true;
  let currentDifficulty = null;

  const difficulties = {
    1: { name: "Viegli", speed: 200 },
    2: { name: "Vidēji", speed: 120 },
    3: { name: "Grūti", speed: 60 }
  };

  function setup() {
    createCanvas(cols * gridSize, rows * gridSize);
    frameRate(60);
  }

  function startGame(difficultyLevel) {
    currentDifficulty = difficulties[difficultyLevel];
    stepInterval = currentDifficulty.speed;
    resetGame();
    choosingDifficulty = false;
  }

  function resetGame() {
    snake = [{ x: floor(cols / 2), y: floor(rows / 2) }];
    dir = { x: 0, y: 0 };
    spawnFood();
    score = 0;
    gameOver = false;
    lastStepTime = millis();
  }

  function draw() {
    background(20);

    if (choosingDifficulty) {
      drawDifficultyMenu();
      return;
    }

    if (!gameOver) {
      const now = millis();
      if (now - lastStepTime >= stepInterval) {
        update();
        lastStepTime = now;
      }
      drawGame();
    } else {
      drawGameOver();
    }
  }

  function update() {
    if (dir.x === 0 && dir.y === 0) return;

    const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };

    if (
      head.x < 0 || head.x >= cols || head.y < 0 || head.y >= rows ||
      snake.some(segment => segment.x === head.x && segment.y === head.y)
    ) {
      gameOver = true;
      return;
    }

    snake.unshift(head);

    if (head.x === food.x && head.y === food.y) {
      spawnFood();
      score++;
    } else {
      snake.pop();
    }
  }

  function drawGame() {
    // Snake
    fill(0, 255, 0);
    for (let segment of snake) {
      rect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
    }

    // Food
    fill(255, 0, 0);
    rect(food.x * gridSize, food.y * gridSize, gridSize, gridSize);

    // Score
    fill(255);
    textSize(16);
    textAlign(LEFT, TOP);
    text(`Punkti: ${score}`, 5, 5);
    text(`Līmenis: ${currentDifficulty.name}`, 5, 25);
  }

  function drawGameOver() {
    fill(255);
    textAlign(CENTER, CENTER);
    textSize(32);
    text('Game Over', width / 2, height / 2 - 30);
    textSize(20);
    text('Tavi punkti: ' + score, width / 2, height / 2);
    textSize(16);
    text('Spied jebkuru bultiņu lai sāktu no jauna', width / 2, height / 2 + 30);
  }

  function drawDifficultyMenu() {
    fill(255);
    textAlign(CENTER, CENTER);
    textSize(24);
    text("Izvēlies grūtības līmeni", width / 2, height / 2 - 40);
    textSize(18);
    text("1 - Viegli (lēni)", width / 2, height / 2);
    text("2 - Vidēji", width / 2, height / 2 + 30);
    text("3 - Grūti (ātri)", width / 2, height / 2 + 60);
  }

  function spawnFood() {
    let valid = false;
    while (!valid) {
      food = {
        x: floor(random(cols)),
        y: floor(random(rows))
      };
      valid = !snake.some(s => s.x === food.x && s.y === food.y);
    }
  }

  function keyPressed() {
    if (choosingDifficulty) {
      if (key === '1' || key === '2' || key === '3') {
        startGame(Number(key));
      }
      return;
    }

    if (gameOver) {
      resetGame();
      return;
    }

    if (keyCode === LEFT_ARROW && dir.x !== 1) {
      dir = { x: -1, y: 0 };
    } else if (keyCode === RIGHT_ARROW && dir.x !== -1) {
      dir = { x: 1, y: 0 };
    } else if (keyCode === UP_ARROW && dir.y !== 1) {
      dir = { x: 0, y: -1 };
    } else if (keyCode === DOWN_ARROW && dir.y !== -1) {
      dir = { x: 0, y: 1 };
    }
  }
</script>
</body>
</html>
